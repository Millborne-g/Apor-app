<!DOCTYPE html>
<!-- Created By CodingNepal -->
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <!-- <title>Sider Menu Bar CSS</title> -->
    <link rel="stylesheet" href="Main-CompanyHead-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"/>
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>

  </head>

  <body>
    <input type="checkbox" id="check">
    <label for="check">
      <i class="fas fa-bars" id="btn"></i>
      <i class="fas fa-times" id="cancel"></i>
    </label>
    <div class="sidebar">
    <header><img src="AdminPic.jpg" alt="Admin"> 
      <br>
      <span id="Company_Head_Name">Admin</span></header>
  <ul>
<li><a href="Main-CompanyHead-Dashboard.html"><i class="fas fa-qrcode"></i>Dashboard</a></li>
<li class="active"><a href="#"><i class="fas fa-calendar-week"></i>Events</a></li>
<li><a href="Main-CompanyHead-Employees.html"><i class="fas fa-user-alt"></i>Employees</a></li>
<li><a href="#"><i class="fas fa-stream"></i>Overview</a></li>
<li><a href="#"><i class="far fa-question-circle"></i>About</a></li>
<!--<li><a href="#"><i class="fas fa-link"></i>Shortcuts</a></li>-->
<!--<li><a href="#"><i class="fas fa-stream"></i>Overview</a></li>

<li><a href="#"><i class="far fa-question-circle"></i>About</a></li>
<li><a href="#"><i class="fas fa-sliders-h"></i>Services</a></li>
<li><a href="#"><i class="far fa-envelope"></i>Contact</a></li>
-->
<script>

   
      $('li').click(function(){
        $(this).addClass("active").siblings().removeClass("active");
      });
    </script>
</ul>


</div>
<section>
  <div class="Top">
    <header>Events<em id="Total">total</em></header>
    <input class = "SearchBar" id="search" type="text" placeholder="Search Events..." name="search">
  </div>

  <div class= "Adding">
    <div>
      <button id="AddUser" onClick="ShowModalAddUser()">Add Events</button>
      <div id="myModalAddUser" class="modalAddUser">

        <!-- Modal content -->
        <div class="modal-contentAddUser">
          <div class="topAddUser">
            <span class="close" id="closeAddUser">&times;</span>
            <p>Add Event</p>
          </div>
          <hr>
          <div class="UserRegisterForm">
            <form id="AddUserFrom">
              <label for='name'>Name <span id="EventWarning">(already exist)</span></label>
              <br>
              <input type="text" name="name" id="NameOfTheEvent" class="AddUserForm" placeholder="Event's Name" required/>

              <label for='address'>Event Destination</label>
              <br>
              <input type="text" name="address" id="EventDestination" class="AddUserForm" placeholder="Location" required>

              <div id="StartDateToTravelDiv">
              <label id = "StartDateToTravelLabel"for='StartDateToTravel'>Start Date</label>
              <br>
              <input type="date" name="StartDateToTravel" id="StartDateToTravel" class="AddUserForm" placeholder="Company Name" required>
              </div>

              <div id="EndDateToTravelDiv">
              <label id="EndDateToTravelLabel" for='EndDateToTravel'>End Date</label>
              <br>
              <input type="date" name="EndDateToTravel" id="EndDateToTravel" class="AddUserForm" placeholder="Company Name" required>
              </div>

              <!--  <br>
              <label for='Type' id="Typelable">Type</label>
              <br>
              <input type="text" name="Type" id="Type" class="AddUserForm" placeholder="Type of Business" required>

              <label for='email'>Email <span id="EmailWarning">(Invalid Email)</span></label>
              <br>
              <input type="text" name="email" id="CompanyEmailAddress" class="AddUserForm" placeholder="Email Adress" required>-->


              <input class="ViewRemButtonsAddUser" id="SubmitAddUser" type="submit" value="Submit" onclick="SubmitValues()">

              
            </form>
          </div>
        </div>

      </div>
      <script>
      function ShowModalAddUser(){
        var closeAddUser = document.getElementById("closeAddUser");
        var modal = document.getElementById("myModalAddUser");
        modal.style.display = "block";
        closeAddUser.onclick = function() {
          var EventWarning = document.getElementById("EventWarning");

          var NameOfTheEvent = document.getElementById("NameOfTheEvent");

          NameOfTheEvent.style.borderColor = "";


          EventWarning.style.display = "none";

        modal.style.display = "none";

      }
        /*
        document.getElementById('FullNameOwner').style.borderColor =  "";
  document.getElementById('CompanyName').style.borderColor =  "";
  document.getElementById('Type').style.borderColor =  "";

  document.getElementById('CompanyLocation').style.borderColor =  "";
  document.getElementById('CompanyEmailAddress').style.borderColor =  "";
*/
  var AddUserFromID = document.getElementById("AddUserFrom");
  var inputs = AddUserFromID.getElementsByTagName('input');
    for (var i = 0; i < inputs.length; i++) {
      //inputs[i].style.borderBottomColor =  "";
      if (inputs[i].value != "Submit"){

        inputs[i].value="";

      }
      
      
    }


      }

      

          
      </script>


    </div>
  </div>




  <div class="data">
    <div class="tableM">
    <table id="list">
        <!--headings-->
        <thead>
          <tr class= "heading">

            <th>Event Name</th>
            <th>Location</th>
            <th>End date</th>
            <th>Total Employee</th>
          </tr>
        </thead>


        <tbody id="listR">



        </tbody>
<div id="myModal" class="modal">

  <!-- Modal content -->
  <div class="modal-content">

    <span class="close" id="closemyModal">&times;</span>

    <h1 id="EventNameView"></h1>
    <h3 id="name"></h3>
    <div class="ViewRemButtons">
      <form action="ViewDetails.html">
      <input id="ViewProf" type="submit" value="View Details" onclick="passval()"/>
      <input id="Remove" type="button" value="Remove" onclick="Delete()"/> 
      </form>

    </div>
  </div>

</div>





</div>

<div id="myModalLoading" class="modalLoading">

  <!-- Modal content -->
  <div class="modal-contentLoading">
    <div class="loading loading--full-height"></div>
    <span>Submitting...</span>

  

    </div>
  </div>


  <div id="myModalSucessfullySubmit" class="modalSucessfullySubmit">

  <!-- Modal content -->
  <div class="modal-contentSucessfullySubmit">
    <div><span>&#x2713;</span></div>
    <span>Save Successfully</span>
    <br>
    <button onclick="okClick()">OK</button>
    


  

    </div>
  </div>


        <script>

        function addRowHandlers() {

          var _Name = document.getElementById('name');
          var _EventNameView = document.getElementById('EventNameView');
          var span = document.getElementsByClassName("close")[0];
          var modal = document.getElementById("myModal");
          var closemyModal = document.getElementById("closemyModal");
    var table = document.getElementById("listR");
    var rows = table.getElementsByTagName("tr");
    for (i = 0; i < rows.length; i++) {
        var currentRow = table.rows[i];
        var createClickHandler = 
            function(row) 
            {
                return function() { 
                  console.log("click");
                                        var EventNameView = row.getElementsByTagName("td")[0];
                                        var cell = row.getElementsByTagName("td")[1];
                                        console.log(cell);
                                        var name_ = cell.innerHTML;
                                        var EventNameView_ = EventNameView.innerHTML;
                                        modal.style.display = "block";
                                        _Name.innerHTML = name_;
                                        _EventNameView.innerHTML=EventNameView_;

                                        //alert("id:" + id);
                                 };
            };

        currentRow.onclick = createClickHandler(currentRow);
    }
    closemyModal.onclick = function() {
  modal.style.display = "none";


}

}
function passval(){
  var EventNameVar = document.getElementById('EventNameView').innerHTML;
  var EventLoc = document.getElementById('name').innerHTML;
  //console.log("hello "+IDnum);
  localStorage.setItem("Company",localStorage.getItem("Company"));
  localStorage.setItem("EventName",EventNameVar);
  localStorage.setItem("EventLoc",EventLoc);
  return false;
  
}

    
    </script>
        
   




    </table>
    




    

    </div>


    <!-- <ul id="list">

    </ul>-->

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-database.js"></script>
    <!-- TODO: Add SDKs for Firebase products that you want to use
         https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-analytics.js"></script>


    <script src="https://smtpjs.com/v3/smtp.js"></script>


    <script id="MainScript">
       // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      var firebaseConfig = {
        apiKey: "AIzaSyAtffua9t3RTkl9u_79XHq4jOneToWWJt4",
        authDomain: "qr-code-generator-8320b.firebaseapp.com",
        databaseURL: "https://qr-code-generator-8320b.firebaseio.com",
        projectId: "qr-code-generator-8320b",
        storageBucket: "qr-code-generator-8320b.appspot.com",
        messagingSenderId: "13212405929",
        appId: "1:13212405929:web:1b5f752dbe85a3198d19b8",
        measurementId: "G-MBZ13F7ZNN"
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      firebase.analytics();



      readDataFromDatabase();

      var counter=0;


      function addItemsToList(NameOfTheEvent,EventDestination,EndDateToTravel,TotalEmployee){


        var count=document.getElementById('Total');
        var ul=document.getElementById('listR');
        var count=document.getElementById('Total');


        var _NameOfTheEvent = document.createElement('td');
        var _EventDestination = document.createElement('td');
        var _EndDateToTravel = document.createElement('td');
        var _TotalEmployee = document.createElement('td');


        var row = document.createElement('tr');

        //header.innerHTML = 'Employee-'+(++counter);

        _NameOfTheEvent.innerHTML = NameOfTheEvent;
        _EventDestination.innerHTML=EventDestination;
        _EndDateToTravel.innerHTML=EndDateToTravel;
        _TotalEmployee.innerHTML=TotalEmployee;

        row.appendChild(_NameOfTheEvent);
        row.appendChild(_EventDestination);
        
        row.appendChild(_EndDateToTravel);
        row.appendChild(_TotalEmployee);

        count.innerHTML = ++counter+' total';
        //readDataFromDatabase();

        ul.appendChild(row);

      }


      
      function readDataFromDatabase(){
      var database = firebase.database().ref("Events/"+localStorage.getItem("Company"));
      document.getElementById("Company_Head_Name").innerHTML= localStorage.getItem("CompanyHeadName");

    database.once("value",function(snapshot){
            var data = snapshot.val();

            for(let i in data){
              //Name,Company,LastActivity,TotalEmployee,Status
              console.log("hello")
              addItemsToList(data[i].NameOfTheEvent,data[i].EventDestination,data[i].EndDateToTravel,data[i].TotalEmployee);
            }

window.onload = addRowHandlers();
            const searchInput = document.getElementById("search");
            const rows = document.querySelectorAll("tbody tr");
            console.log(rows);
            searchInput.addEventListener("keyup", function (event) {
              const q = event.target.value.toLowerCase();
              rows.forEach((row) => {
                row.querySelector("td").textContent.toLowerCase().startsWith(q)
                  ? (row.style.display = "table-row")
                  : (row.style.display = "none");
              });
            });
    });
}

function CheckField(){


  var FieldEmpty = false;
  var AddUserFromID = document.getElementById("AddUserFrom");
  var inputs = AddUserFromID.getElementsByTagName('input');
  

  
    for (var i = 0; i < inputs.length; i++) {
        // only validate the inputs that have the required attribute
        //inputs[i].style.borderBottomColor =  "";
        if(inputs[i].hasAttribute("required")){
            if(inputs[i].value == ""){
                FieldEmpty = true;
                //return false;
                ;
            }
        }
        //inputs[i].style.borderBottomColor =  "";
    }
    
    //return true;
    console.log("FieldEmpty jijijhh"+FieldEmpty);
    if(FieldEmpty == false){
      SubmitValues();
    }


}

function SubmitValues(){

  var NameOfTheEvent = document.getElementById("NameOfTheEvent").value;
  var EventDestination = document.getElementById("EventDestination").value;
  var StartDateToTravel = document.getElementById("StartDateToTravel").value;
  var EndDateToTravel = document.getElementById("EndDateToTravel").value;

  var modalSucessfullySubmit = document.getElementById("myModalSucessfullySubmit");
  var modalLoading = document.getElementById("myModalLoading");

  var EventWarning = document.getElementById("EventWarning");

  var NameOfTheEventBorder = document.getElementById("NameOfTheEvent");

  var StartDateToTravelDate = new Date(document.getElementById("StartDateToTravel").value);
  var EndDateToTravelDate = new Date(document.getElementById("EndDateToTravel").value);

  var total_Time = EndDateToTravelDate.getTime() -  StartDateToTravelDate.getTime();

  var Difference_In_Days = total_Time / (1000 * 3600 * 24);

  console.log("total_days "+(1+Difference_In_Days));

          

  var FieldEmpty = false;
  var AddUserFromID = document.getElementById("AddUserFrom");
  var inputs = AddUserFromID.getElementsByTagName('input');

  EventWarning.style.display = "none";
  NameOfTheEventBorder.style.borderColor = "";

  for (var i = 0; i < inputs.length; i++) {
      if(inputs[i].hasAttribute("required")){
         if(inputs[i].value == ""){
          FieldEmpty = true;
      }
    }
  }

  if(FieldEmpty == false){
    var checkNameOfTheEvent = false

    var databaseCheck = firebase.database().ref("Events/"+localStorage.getItem("Company"));

    databaseCheck.once("value",function(snapshot){
            var data = snapshot.val();

            for(let i in data){
              if (data[i].NameOfTheEvent==NameOfTheEvent){
                checkNameOfTheEvent = true;
                break;

              }
            }

            if(checkNameOfTheEvent == false){
              firebase.database().ref('Destinations/'+NameOfTheEvent).set({
                  EventDestination: EventDestination
                  
            });
                  firebase.database().ref('Events/'+localStorage.getItem("Company")+'/'+NameOfTheEvent).set({
                  NameOfTheEvent:NameOfTheEvent,
                  EventDestination: EventDestination,
                  StartDateToTravel: StartDateToTravel,
                  EndDateToTravel: EndDateToTravel,
                  CompanyName:localStorage.getItem("Company"),
                  TotalEmployee: 0,
                  total_days:(1+Difference_In_Days)
            }).then(
            message => modalSucessfullySubmit.style.display = "block"

                                
                                //location.reload()
            );


            }
            else{
              NameOfTheEventBorder.style.borderColor = "#d64242";
              EventWarning.style.display = "block";
              console.log("Already in the list");
              function handleForm(event) { event.preventDefault(); } 
              AddUserFromID.addEventListener('submit', handleForm);

            }
          });


    //modalSucessfullySubmit.style.display = "block";
    //location.reload();
    function handleForm(event) { event.preventDefault(); } 
  AddUserFromID.addEventListener('submit', handleForm);

  }

  function handleForm(event) { event.preventDefault(); } 
  AddUserFromID.addEventListener('submit', handleForm);
  
  

         
      }

  function Delete(){
    var database = firebase.database().ref("Employees");
    var EventNameView =document.getElementById('EventNameView').innerHTML;
      document.getElementById("Company_Head_Name").innerHTML= localStorage.getItem("CompanyHeadName");
      document.getElementById("myModalLoading").style.display = "block";

    database.once("value",function(snapshot){
            var data = snapshot.val();
            var countDel = 0;
            var sign = false; 

            for(let i in data){
              var EmpIDNumber = "";
              

              var databaseDelEvent = firebase.database().ref("Employees/"+data[i].EmpIDNumber+"/Events");
              databaseDelEvent.once("value",function(snapshot){
            var dataDelEvent = snapshot.val();
            for(let x in dataDelEvent){

              if(dataDelEvent[x].EventName==EventNameView && data[i].CompanyName==localStorage.getItem("Company")){
                
                firebase.database().ref("Employees/"+data[i].EmpIDNumber+"/Events/"+dataDelEvent[x].EventName).remove();
                
                

              };


            }



          });


            }
          firebase.database().ref('Destinations/'+EventNameView).remove();
          firebase.database().ref('Events/'+localStorage.getItem("Company")+'/'+EventNameView).remove();
          setTimeout(function(){ document.getElementById("myModalLoading").style.display = "none"; location.reload()}, 3000);

          //location.reload();

          

          });

    
    //firebase.database().ref('Destinations/'+EventNameView).remove();
    //firebase.database().ref('Events/'+localStorage.getItem("Company")+'/'+EventNameView).remove();

    //location.reload();

  }


  function okClick(){
    location.reload();
    
  }







      
      
      
     



    </script>


    
  </div>

  


  
</section>




  </body>
  
    
  <script>
  function changeLanguage(language) {
                    var element = document.getElementById("url");
                    element.value = language;
                    element.innerHTML = language;
                }

                function showDropdown() {
                    document.getElementById("myDropdown").classList.toggle("show");

                    console.log("hello");
                }

                // Close the dropdown if the user clicks outside of it
                window.onclick = function(event) {
                    if (!event.target.matches('.dropbtn')) {
                        var dropdowns = document.getElementsByClassName("dropdown-content");
                        var i;
                        for (i = 0; i < dropdowns.length; i++) {
                            var openDropdown = dropdowns[i];
                            if (openDropdown.classList.contains('show')) {
                                openDropdown.classList.remove('show');
                            }
                        }
                    }
                }
 
  </script>

 
  
</html>

