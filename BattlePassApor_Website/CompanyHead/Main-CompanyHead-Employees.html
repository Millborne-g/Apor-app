<!DOCTYPE html>
<!-- Created By CodingNepal -->
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <!-- <title>Sider Menu Bar CSS</title> -->
    <link rel="stylesheet" href="Main-CompanyHead-Employees.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"/>
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>

  </head>

  <body>
    <input type="checkbox" id="check">
    <label for="check">
      <i class="fas fa-bars" id="btn"></i>
      <i class="fas fa-times" id="cancel"></i>
    </label>
    <div class="sidebar">
    <header><img src="AdminPic.jpg" alt="Admin"> 
      <br>
      <span id="Company_Head_Name">Admin</span></header>
  <ul>
<li><a href="Main-CompanyHead-Dashboard.html"><i class="fas fa-qrcode"></i>Dashboard</a></li>
<li><a href="Main-CompanyHead.html"><i class="fas fa-calendar-week"></i>Events</a></li>
<li  class="active"><a href="#"><i class="fas fa-user-alt"></i>Employees</a></li>
<li><a href="#"><i class="fas fa-stream"></i>Overview</a></li>
<li><a href="#"><i class="far fa-question-circle"></i>About</a></li>
<!--<li><a href="#"><i class="fas fa-link"></i>Shortcuts</a></li>-->
<!--<li><a href="#"><i class="fas fa-stream"></i>Overview</a></li>

<li><a href="#"><i class="far fa-question-circle"></i>About</a></li>
<li><a href="#"><i class="fas fa-sliders-h"></i>Services</a></li>
<li><a href="#"><i class="far fa-envelope"></i>Contact</a></li>
-->
<script>

   
      $('li').click(function(){
        $(this).addClass("active").siblings().removeClass("active");
      });
    </script>
</ul>


</div>
<section>
  <div class="Top">
    <header>Employees<em id="Total">total</em></header>
    <input class = "SearchBar" id="search" type="text" placeholder="Search Employee..." name="search">
  </div>

  <div class= "Adding">
    <div>
      <button id="AddUser" onClick="ShowModalAddUser()">Add Employee</button>
      <div id="myModalAddUser" class="modalAddUser">

        <!-- Modal content -->
        <div class="modal-contentAddUser">
          <div class="topAddUser">
            <span class="close" id="closeAddUser">&times;</span>
            <p>Add Employee</p>
          </div>
          <hr>
          <div class="UserRegisterForm">
            <form id="AddUserFrom">
              <label for='name'>Name <span id="EventWarning">(already exist)</span></label>
              <br>
              <input type="text" name="name" id="NameOfTheEMployee" class="AddUserForm" placeholder="Employee's name" required/>

              <label for='name'>ID Number</label>
              <br>
              <input type="text" name="name" id="EmpIDNumber" class="AddUserForm" placeholder="Employee's ID number" required/>

              <label for='address'>Home Address</label>
              <br>
              <input type="text" name="address" id="HomeAddressEmployee" class="AddUserForm" placeholder="Address" required>

              <label for='email'>Contact Number</label>
              <br>
              <input type="text" name="number" id="ContactNumber" class="AddUserForm" placeholder="09*******" required>

              <label for='email'>Email <span id="EmailWarning">(Invalid Email)</span> </label>
              <br>
              <input type="text" name="email" id="EmployeeEmailAddress" class="AddUserForm" placeholder="Email Adress" required>
             

              <!--  <br>
              <label for='Type' id="Typelable">Type</label>
              <br>
              <input type="text" name="Type" id="Type" class="AddUserForm" placeholder="Type of Business" required>

              <label for='email'>Email <span id="EmailWarning">(Invalid Email)</span></label>
              <br>
              <input type="text" name="email" id="CompanyEmailAddress" class="AddUserForm" placeholder="Email Adress" required>-->


              <input class="ViewRemButtonsAddUser" id="SubmitAddUser" type="submit" value="Submit" onclick="SubmitValues()">

              
            </form>
          </div>
        </div>

      </div>
      <script>
      function ShowModalAddUser(){
        var closeAddUser = document.getElementById("closeAddUser");
        var modal = document.getElementById("myModalAddUser");
        modal.style.display = "block";
        closeAddUser.onclick = function() {
          var EventWarning = document.getElementById("EventWarning");

          var NameOfTheEvent = document.getElementById("NameOfTheEMployee");

          NameOfTheEvent.style.borderColor = "";


          EventWarning.style.display = "none";

        modal.style.display = "none";

      }
        /*
        document.getElementById('FullNameOwner').style.borderColor =  "";
  document.getElementById('CompanyName').style.borderColor =  "";
  document.getElementById('Type').style.borderColor =  "";

  document.getElementById('CompanyLocation').style.borderColor =  "";
  document.getElementById('CompanyEmailAddress').style.borderColor =  "";
*/
  var AddUserFromID = document.getElementById("AddUserFrom");
  var inputs = AddUserFromID.getElementsByTagName('input');
    for (var i = 0; i < inputs.length; i++) {
      //inputs[i].style.borderBottomColor =  "";
      if (inputs[i].value != "Submit"){

        inputs[i].value="";

      }
      
      
    }


      }

      

          
      </script>


    </div>
  </div>




  <div class="data">
    <div class="tableM">
    <table id="list">
        <!--headings-->
        <thead>
          <tr class= "heading">

            <th>Name</th>
            <th>ID</th>
            <th>Email Address</th>
            <th>No. Events</th>
            <!--<th>Total Employee</th>-->
          </tr>
        </thead>


        <tbody id="listR">



        </tbody>
<div id="myModal" class="modal">

  <!-- Modal content -->
  <div class="modal-content">

    <span class="close" id="closemyModal">&times;</span>

    <h1 id="EventNameView"></h1>
    <h3 id="name"></h3>
    <div class="ViewRemButtons">
      <form action="ViewDetails.html">
      <!--<input id="ViewProf" type="submit" value="View Details" onclick="passval()"/>-->
      <input id="Remove" type="button" value="Remove" onclick="Delete()"/> 
      </form>

    </div>
  </div>

</div>





</div>

<div id="myModalLoading" class="modalLoading">

  <!-- Modal content -->
  <div class="modal-contentLoading">
    <div class="loading loading--full-height"></div>
    <span>Submitting...</span>

  

    </div>
  </div>


  <div id="myModalSucessfullySubmit" class="modalSucessfullySubmit">

  <!-- Modal content -->
  <div class="modal-contentSucessfullySubmit">
    <div><span>&#x2713;</span></div>
    <span>Save Successfully</span>
    <br>
    <button onclick="okClick()">OK</button>
    


  

    </div>
  </div>


        <script>

        function addRowHandlers() {
          
          
          var _Name = document.getElementById('name');
          var _EventNameView = document.getElementById('EventNameView');
          var span = document.getElementsByClassName("close")[0];
          var modal = document.getElementById("myModal");
          var closemyModal = document.getElementById("closemyModal");
    var table = document.getElementById("listR");
    var rows = table.getElementsByTagName("tr");
    for (i = 0; i < rows.length; i++) {
        var currentRow = table.rows[i];
        var createClickHandler = 
            function(row) 
            {
                return function() { 
                  console.log("click");
                                        var EventNameView = row.getElementsByTagName("td")[0];
                                        var cell = row.getElementsByTagName("td")[1];
                                        console.log(cell);
                                        var name_ = cell.innerHTML;
                                        var EventNameView_ = EventNameView.innerHTML;
                                        modal.style.display = "block";
                                        _Name.innerHTML = name_;
                                        _EventNameView.innerHTML=EventNameView_;

                                        //alert("id:" + id);
                                 };
            };

        currentRow.onclick = createClickHandler(currentRow);
    }
    closemyModal.onclick = function() {
  modal.style.display = "none";


}

}
function passval(){
  var EventNameVar = document.getElementById('EventNameView').innerHTML;
  var EventLoc = document.getElementById('name').innerHTML;
  //console.log("hello "+IDnum);
  localStorage.setItem("Company",localStorage.getItem("Company"));
  localStorage.setItem("EventName",EventNameVar);
  localStorage.setItem("EventLoc",EventLoc);
  return false;
  
}

    
    </script>
        
   




    </table>
    




    

    </div>


    <!-- <ul id="list">

    </ul>-->

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-database.js"></script>
    <!-- TODO: Add SDKs for Firebase products that you want to use
         https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-analytics.js"></script>


    <script src="https://smtpjs.com/v3/smtp.js"></script>


    <script id="MainScript">
       // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      var firebaseConfig = {
        apiKey: "AIzaSyAtffua9t3RTkl9u_79XHq4jOneToWWJt4",
        authDomain: "qr-code-generator-8320b.firebaseapp.com",
        databaseURL: "https://qr-code-generator-8320b.firebaseio.com",
        projectId: "qr-code-generator-8320b",
        storageBucket: "qr-code-generator-8320b.appspot.com",
        messagingSenderId: "13212405929",
        appId: "1:13212405929:web:1b5f752dbe85a3198d19b8",
        measurementId: "G-MBZ13F7ZNN"
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      firebase.analytics();



      readDataFromDatabase();

      var counter=0;


      function addItemsToList(NameOfTheEvent,EventDestination,EndDateToTravel,TotalEmployee){


        var count=document.getElementById('Total');
        var ul=document.getElementById('listR');
        var count=document.getElementById('Total');


        var _NameOfTheEvent = document.createElement('td');
        var _EventDestination = document.createElement('td');
        var _EndDateToTravel = document.createElement('td');
        var _TotalEmployee = document.createElement('td');


        var row = document.createElement('tr');

        //header.innerHTML = 'Employee-'+(++counter);

        _NameOfTheEvent.innerHTML = NameOfTheEvent;
        _EventDestination.innerHTML=EventDestination;
        _EndDateToTravel.innerHTML=EndDateToTravel;
        _TotalEmployee.innerHTML=TotalEmployee;

        row.appendChild(_NameOfTheEvent);
        row.appendChild(_EventDestination);
        
        row.appendChild(_EndDateToTravel);
        row.appendChild(_TotalEmployee);

        count.innerHTML = ++counter+' total';
        //readDataFromDatabase();

        ul.appendChild(row);

      }


      
      function readDataFromDatabase(){
      var database = firebase.database().ref("Employees");
      document.getElementById("Company_Head_Name").innerHTML= localStorage.getItem("CompanyHeadName");

    database.once("value",function(snapshot){
            var data = snapshot.val();
            console.log("Emp "+data);

            for(let i in data){
              
              //Name,Company,LastActivity,TotalEmployee,Status
              /*
              var databaseNumEvents = firebase.database().ref("Employees/"+data[i].NameOfTheEMployee+"/Events");
              databaseNumEvents.once("value",function(snapshot){
              var dataEvents = snapshot.val();
              for(let i in dataEvents ){
                EventCount=i;
              */

              
              if(data[i].CompanyName==localStorage.getItem("Company")){
                var EventCount = 0;
                
                var databaseNumEvents = firebase.database().ref("Employees/"+data[i].EmpIDNumber+"/Events");
              databaseNumEvents.once("value",function(snapshot){
                var dataEvents = snapshot.val();
                console.log("events "+dataEvents);

              for(let x in dataEvents ){
                EventCount++;
                //console.log("events "+dataEvents[x].EventLoc);

              }
              console.log("hello")

              addItemsToList(data[i].NameOfTheEMployee,data[i].EmpIDNumber,data[i].EmployeeEmailAddress,EventCount);//,data[i].EndDateToTravel,data[i].TotalEmployee);
              EventCount = 0;
              window.onload = addRowHandlers();
            const searchInput = document.getElementById("search");
            const rows = document.querySelectorAll("tbody tr");
            console.log(rows);
            searchInput.addEventListener("keyup", function (event) {
              console.log("click");
              const q = event.target.value.toLowerCase();
              rows.forEach((row) => {
                row.querySelector("td").textContent.toLowerCase().startsWith(q)
                  ? (row.style.display = "table-row")
                  : (row.style.display = "none");
              });
            });


              });

                

              }




                //});

              
            }


    });
}

function CheckField(){


  var FieldEmpty = false;
  var AddUserFromID = document.getElementById("AddUserFrom");
  var inputs = AddUserFromID.getElementsByTagName('input');
  

  
    for (var i = 0; i < inputs.length; i++) {
        // only validate the inputs that have the required attribute
        //inputs[i].style.borderBottomColor =  "";
        if(inputs[i].hasAttribute("required")){
            if(inputs[i].value == ""){
                FieldEmpty = true;
                //return false;
                ;
            }
        }
        //inputs[i].style.borderBottomColor =  "";
    }
    
    //return true;
    console.log("FieldEmpty jijijhh"+FieldEmpty);
    if(FieldEmpty == false){
      SubmitValues();
    }


}

function SubmitValues(){

  var NameOfTheEMployee = document.getElementById("NameOfTheEMployee").value;
  var EmpIDNumber = document.getElementById("EmpIDNumber").value;
  var HomeAddressEmployee = document.getElementById("HomeAddressEmployee").value;
  var ContactNumber = document.getElementById("ContactNumber").value;
  var EmployeeEmailAddress = document.getElementById("EmployeeEmailAddress").value;

  var modalSucessfullySubmit = document.getElementById("myModalSucessfullySubmit");
  var modalLoading = document.getElementById("myModalLoading");

  var EventWarning = document.getElementById("EventWarning");
  var NameOfTheEventBorder = document.getElementById("NameOfTheEMployee");

  var spanEmail = document.getElementById("EmailWarning");

  


  var EmailTextBox = document.getElementById("EmployeeEmailAddress");
  

  var mailformat = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;

  var FieldEmpty = false;
  var AddUserFromID = document.getElementById("AddUserFrom");
  var inputs = AddUserFromID.getElementsByTagName('input');

  EventWarning.style.display = "none";
  NameOfTheEventBorder.style.borderColor = "";
  EmailTextBox.style.borderColor  = "";
  spanEmail.style.display="none";

  var EmpIDNumberAlreadyExist = false;

  for (var i = 0; i < inputs.length; i++) {
      if(inputs[i].hasAttribute("required")){
         if(inputs[i].value == ""){
          FieldEmpty = true;
      }
    }
  }

  console.log(FieldEmpty);
  function handleForm(event) { event.preventDefault(); } 
  AddUserFromID.addEventListener('submit', handleForm);

  if(FieldEmpty == false){
    var checkNameOfTheEmployee = false
    var checkEventOfTheEmployee = false

    var databaseCheck = firebase.database().ref("Employees");
    var databaseCheckEvent = firebase.database().ref("Employees/"+EmpIDNumber+"/Events");

    databaseCheck.once("value",function(snapshot){
            var data = snapshot.val();

            for(let i in data){
              if (data[i].NameOfTheEMployee==NameOfTheEMployee){
                checkNameOfTheEmployee = true;
              }
              if (data[i].EmpIDNumber==EmpIDNumber){
                EmpIDNumberAlreadyExist = true;
                break;

              }
            }
            databaseCheckEvent.once("value",function(snapshot){
              var data2 = snapshot.val();

            for(let i in data2){
              console.log("From database Event "+data2[i].EventName);
              if (data2[i].EventName==localStorage.getItem("EventName")){
                checkEventOfTheEmployee = true;
                break;

              }
            }
            console.log(checkNameOfTheEmployee+ " " + checkEventOfTheEmployee+ " "+EmpIDNumberAlreadyExist);
            if(checkNameOfTheEmployee == true && checkEventOfTheEmployee == false && EmpIDNumberAlreadyExist == true){
              modalLoading.style.display = "block";
              firebase.database().ref("Events/"+localStorage.getItem("Company")+"/"+localStorage.getItem("EventName")).update({
                      TotalEmployee:counter+1
                    });
                    firebase.database().ref('Employees/'+EmpIDNumber+'/Events').child(localStorage.getItem("EventName")).set({
                    EventStart:EventStart,
                    EventEnd:EventEnd,
                    
                    EventName:localStorage.getItem("EventName"),
                    EventLoc:localStorage.getItem("EventLoc")
                  }).then(
                    message => modalSucessfullySubmit.style.display = "block"
                    
                    //location.reload()
                  );

            };

            if(checkNameOfTheEmployee == false && checkEventOfTheEmployee == false){
              //console.log("mailformat.test(EmployeeEmailAddress "+mailformat.test(EmployeeEmailAddress));
              
                if(mailformat.test(EmployeeEmailAddress)==true){
                    modalLoading.style.display = "block";
                    //var databaseEvent = firebase.database().ref("Events/"+localStorage.getItem("Company")+"/"+localStorage.getItem("EventName"));
                    
                    firebase.database().ref('Employees/'+EmpIDNumber).set({
                    NameOfTheEMployee:NameOfTheEMployee,
                    HomeAddressEmployee: HomeAddressEmployee,
                    ContactNumber: ContactNumber,
                    EmployeeEmailAddress: EmployeeEmailAddress,
                    CompanyName: localStorage.getItem("Company"),
                    EmpIDNumber: EmpIDNumber,
                    ImageProf: "https://png.pngitem.com/pimgs/s/24-248594_user-profile-successful-check-verified-verified-user-icon.png",
                    //EventName:localStorage.getItem("EventName"),
                    username: EmpIDNumber,
                    PasswordEmployee: 'employee'+(counter+1),
                    QRcode:NameOfTheEMployee,
                    scanned: 0
              }); 
                    /*
                    if(checkNameOfTheEmployee == false){

                    firebase.database().ref('Employees/'+EmpIDNumber+'/Events').child(localStorage.getItem("EventName")).set({
                    EventStart:EventStart,
                    EventEnd:EventEnd,
                    
                    EventName:localStorage.getItem("EventName"),
                    EventLoc:localStorage.getItem("EventLoc")
              }); }
*/

                    Email.send({
                      Host : "smtp.gmail.com",
                      Username : "AporBattlePass@gmail.com",
                      Password : "vkzrxvvvzgskqdcq",
                      To : EmployeeEmailAddress,
                      From : "AporBattlePass@gmail.com",
                      Subject : "Apor Battle Pass Employee User Credential (" +localStorage.getItem("Company")+")" ,
      Body : "Hello good day! <br/> This is AporBattlePass Company Head Admin ("+localStorage.getItem("Company")+"), we sucessfully registered your account. <br/> Below are your account details. <br/> <br/> Username: "+ EmpIDNumber+" <br/> Password: employee"+(counter+1)+" <br/> Thank you for trusting us. " 

                  }).then(
                    message => modalSucessfullySubmit.style.display = "block"
                    
                    //location.reload()
                  );
              console.log("Successfully");
              function handleForm(event) { event.preventDefault(); } 
              AddUserFromID.addEventListener('submit', handleForm);
              }
              else{
                EmailTextBox.style.borderColor  = "#d64242";

                  spanEmail.style.display="block";
                    //modal.style.display = "none";
                    function handleForm(event) { event.preventDefault(); } 
                AddUserFromID.addEventListener('submit', handleForm);
              }

            }
            else{
              document.getElementById("EmpIDNumber").value="";
              NameOfTheEventBorder.style.borderColor = "#d64242";
              EventWarning.style.display = "block";
              console.log("Already in the list");
              function handleForm(event) { event.preventDefault(); } 
              AddUserFromID.addEventListener('submit', handleForm);

            }
            });
          });
  }

/*
  var modalSucessfullySubmit = document.getElementById("myModalSucessfullySubmit");
  var modalLoading = document.getElementById("myModalLoading");

  var EventWarning = document.getElementById("EventWarning");

  var NameOfTheEventBorder = document.getElementById("NameOfTheEvent");

          

  var FieldEmpty = false;
  var AddUserFromID = document.getElementById("AddUserFrom");
  var inputs = AddUserFromID.getElementsByTagName('input');

  EventWarning.style.display = "none";
  NameOfTheEventBorder.style.borderColor = "";

  console.log("hello");

  for (var i = 0; i < inputs.length; i++) {
      if(inputs[i].hasAttribute("required")){
         if(inputs[i].value == ""){
          FieldEmpty = true;
      }
    }
  }

  if(FieldEmpty == false){
    var checkNameOfTheEvent = false

    var databaseCheck = firebase.database().ref("Employees");

    databaseCheck.once("value",function(snapshot){
            var data = snapshot.val();

            for(let i in data){
              if (data[i].NameOfTheEMployee==NameOfTheEMployee){
                checkNameOfTheEvent = true;
                break;

              }
            }

            if(checkNameOfTheEvent == false){
                  firebase.database().ref('Employees/'+NameOfTheEMployee).set({
                  NameOfTheEMployee:NameOfTheEMployee,
                  HomeAddressEmployee: HomeAddressEmployee,
                  ContactNumber: ContactNumber,
                  EmployeeEmailAddress: EmployeeEmailAddress,
                  username: EmployeeEmailAddress,
                  PasswordEmployee: 'Company'+1
            }).then(
            message => modalSucessfullySubmit.style.display = "block"

                                
                                //location.reload()
            );
            console.log("Successfully");
            function handleForm(event) { event.preventDefault(); } 
  AddUserFromID.addEventListener('submit', handleForm);

            }
            else{
              NameOfTheEventBorder.style.borderColor = "#d64242";
              EventWarning.style.display = "block";
              console.log("Already in the list");
              function handleForm(event) { event.preventDefault(); } 
              AddUserFromID.addEventListener('submit', handleForm);

            }
          });


    //modalSucessfullySubmit.style.display = "block";
    //location.reload();
    function handleForm(event) { event.preventDefault(); } 
  AddUserFromID.addEventListener('submit', handleForm);

  }

  function handleForm(event) { event.preventDefault(); } 
  AddUserFromID.addEventListener('submit', handleForm);
  
  

         */

         
      }

  function Delete(){
    var idnumDis=document.getElementById('name').innerHTML;
    firebase.database().ref('Employees/'+idnumDis).remove();
    //firebase.database().ref('Events/'+localStorage.getItem("Company")+'/'+EventNameView).remove();

    location.reload();
    //document.getElementById("myModalSucessfullySubmit").style.display="block";

  }


  function okClick(){
    location.reload();
    
  }







      
      
      
     



    </script>


    
  </div>

  


  
</section>




  </body>
  
    
  <script>
  function changeLanguage(language) {
                    var element = document.getElementById("url");
                    element.value = language;
                    element.innerHTML = language;
                }

                function showDropdown() {
                    document.getElementById("myDropdown").classList.toggle("show");

                    console.log("hello");
                }

                // Close the dropdown if the user clicks outside of it
                window.onclick = function(event) {
                    if (!event.target.matches('.dropbtn')) {
                        var dropdowns = document.getElementsByClassName("dropdown-content");
                        var i;
                        for (i = 0; i < dropdowns.length; i++) {
                            var openDropdown = dropdowns[i];
                            if (openDropdown.classList.contains('show')) {
                                openDropdown.classList.remove('show');
                            }
                        }
                    }
                }
 
  </script>

 
  
</html>

